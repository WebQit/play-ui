(()=>{function f(r){return!Array.isArray(r)&&typeof r=="object"&&r}function a(r){return typeof r=="function"}function p(r){return Array.isArray(r)||typeof r=="object"&&r||a(r)}function l(r){return a(r)||r&&{}.toString.call(r)==="[object function]"}var O=(r,c,y)=>class extends r{static get reflexFunctions(){return[]}static get reflexFunctionsEnv(){return{}}constructor(){super();let e=this.constructor;Object.defineProperty(this,"reflexFunctionsInternals",{value:new Map}),this._init=e.reflexFunctions.map(t=>{if(!l(this[t]))throw new Error(`[PLAY_ELEMENT]: ${t} is not a method.`);if(t==="constructor")throw new Error("[PLAY_ELEMENT]: Class constructors cannot be reflex methods.");return u(e.reflexCompile(this[t]),([n,o])=>{Object.defineProperty(this,t,{value:n}),this.reflexFunctionsInternals.set(t,o)})}),(this._init=this._init.filter(t=>t instanceof Promise)).length&&(this._init=Promise.all(this._init))}connectedCallback(){super.connectedCallback&&super.connectedCallback();let e=this.constructor;u(this._init,()=>{e.reflexFunctions.forEach(t=>{let n=this[t]();u(n,([,o])=>{e.reflexBind(this.reflexFunctionsInternals.get(t),o,this)})})})}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback();let e=this.constructor;u(this._init,()=>{e.reflexFunctions.forEach(t=>{e.reflexUnbind(this.reflexFunctionsInternals.get(t))})})}static reflexCompile(e){let t=e.toString();l(e)&&(!t.startsWith("function ")&&!t.startsWith("function(")&&(t=t.startsWith("async ")?t.replace("async ","async function "):`function ${t}`),t=`
return ${t.replace("function","function **")}`);let n=[];f(this.reflexFunctionsEnv)&&(n=[`{ ${Object.keys(this.reflexFunctionsEnv).join(", ")} }`]);let o=c(n,t,{compilerParams:this.compilerParams,runtimeParams:this.runtimeParams});return f(this.reflexFunctionsEnv)?u(o(this.reflexFunctionsEnv),([m])=>[m,c.inspect(m)]):[o,c.inspect(o)]}static reflexBind(e,t,n=void 0){u(e,o=>{let m={...this.reflexFunctionsEnv||{},this:n},x=(i,s)=>(Array.isArray(s)?s:[s]).map(_=>[...i,..._.path||[_.key]]);o.processes=o.dependencies.map(i=>p(m[i[0]])?i.length===1?void 0:y.reduce(m[i[0]],i.slice(1),y.observe,s=>{t(...x([i[0]],s))}):y.reduce(globalThis,i,y.observe,s=>{t(...x([],s))}))})}static reflexUnbind(e){u(e,t=>{t?.processes.forEach(n=>n?.abort())})}static get runtimeParams(){return{apiVersion:2}}static get compilerParams(){return{}}},u=(r,c)=>r instanceof Promise?r.then(c):c(r);function d(r){if(typeof self.webqit!="object")throw new Error('No "webqit" object in context.');if(typeof self.webqit.ReflexFunction!="function")throw new Error('No "webqit.ReflexFunction" function in context.');if(typeof self.webqit.Observer!="object")throw new Error('No "webqit.Observer" object in context.');return O(r,window.webqit.ReflexFunction,window.webqit.Observer)}self.webqit||(self.webqit={});self.webqit.PlayElement=d;})();
//# sourceMappingURL=main.js.map
